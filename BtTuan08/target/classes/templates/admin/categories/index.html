<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Category Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-r from-purple-100 to-teal-100 min-h-screen flex flex-col items-center">

<!-- Header -->
<div class="max-w-4xl mx-auto mt-6 bg-white shadow-md rounded-xl p-4 flex items-center gap-4 border border-gray-200">
    <img src="/img/TriNguyen.jpg"
         alt="Avatar"
         class="w-20 h-20 object-cover rounded-full border-2 border-purple-500">
    <div>
        <h2 class="text-xl font-bold text-gray-800">Category Management</h2>
        <p class="text-gray-600">MSSV: <span class="font-medium">23110258</span> ‚Äì NGUYEN THANH LUAN<p>
    </div>
</div>

<!-- Menu -->
<div class="max-w-4xl mx-auto mt-6 bg-white shadow-lg rounded-2xl p-4 flex gap-6 justify-center border border-gray-200">
    <a href="/#">
        <button
                class="px-5 py-2.5 bg-gradient-to-r from-green-500 to-teal-500 text-white font-medium rounded-xl shadow-md hover:shadow-lg hover:scale-105 transition-transform duration-200 flex items-center gap-2">
            üìÇ Categories
        </button>
    </a>
    <a href="/admin/product/index">
        <button
                class="px-5 py-2.5 bg-gradient-to-r from-green-500 to-teal-500 text-white font-medium rounded-xl shadow-md hover:shadow-lg hover:scale-105 transition-transform duration-200 flex items-center gap-2">
            üì¶ Products
        </button>
    </a>
    <!-- D√πng Bootstrap data-bs-toggle -->
    <button data-bs-toggle="modal" data-bs-target="#categoryModal"
            class="px-5 py-2.5 bg-gradient-to-r from-pink-500 to-red-500 text-white font-medium rounded-xl shadow-md hover:shadow-lg hover:scale-105 transition-transform duration-200 flex items-center gap-2">
        ‚ûï Add Category
    </button>
</div>

<hr class="w-3/4 border-gray-400 my-4"/>

<!-- Content -->
<section class="w-3/4 bg-white p-8 rounded-xl shadow-lg">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-semibold text-gray-800">üìÇ Danh s√°ch Category</h2>
        <!-- D√πng Bootstrap data-bs-toggle -->
        <button data-bs-toggle="modal" data-bs-target="#categoryModal"
                class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
            ‚ûï Th√™m m·ªõi
        </button>
    </div>

    <!-- Search -->
    <div class="flex gap-3 mb-6">
        <input type="text" id="searchInput" placeholder="üîç Nh·∫≠p t√™n Category..."
               class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-purple-400"/>
        <button onclick="searchCategories()"
                class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition">
            Search
        </button>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
        <table class="w-full border border-gray-200 rounded-lg shadow-sm">
            <thead class="bg-purple-50 text-gray-700">
            <tr>
                <th class="px-4 py-2 border">ID</th>
                <th class="px-4 py-2 border">Name</th>
                <th class="px-4 py-2 border">Image</th>
                <th class="px-4 py-2 border text-center">Actions</th>
            </tr>
            </thead>
            <tbody id="categoryTable" class="text-gray-700"></tbody>
        </table>
    </div>

    <div id="pagination" class="flex justify-center items-center gap-2 mt-6"></div>
</section>

<hr class="w-3/4 border-gray-400 my-4"/>

<!-- Footer -->
<footer class="text-center py-4 text-gray-600">
    <p>¬© 2025 Category Management App - Built with ‚ù§Ô∏è</p>
</footer>

<!-- Modal -->
<div class="modal fade" id="categoryModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="categoryForm" enctype="multipart/form-data">
                <div class="modal-header">
                    <h5 class="modal-title">Add Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="categoryId">
                    <div class="mb-3">
                        <label for="name" class="form-label">Category Name</label>
                        <input type="text" id="name" name="name" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="imageFile" class="form-label">Image</label>
                        <input type="file" id="imageFile" name="imageFile" class="form-control">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Save</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Script -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let allCategories = [];

    function loadCategories() {
        $.get("/api/categories", function (data) {
            allCategories = data;
            displayCategories(data);
        });
    }

    function displayCategories(cats) {
        let rows = "";
        cats.forEach(function (cat) {
            rows += `
                <tr class="hover:bg-purple-50">
                    <td class="px-4 py-2 border">${cat.id}</td>
                    <td class="px-4 py-2 border">${cat.name}</td>
                    <td class="px-4 py-2 border">
                        ${cat.image ? `<img src="/uploads/${cat.image}" width="80" class="object-cover rounded">` : ""}
                    </td>
                    <td class="px-4 py-2 border text-center space-x-2">
                        <button class="px-3 py-1 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition" onclick="editCategory(${cat.id})">‚úèÔ∏è Edit</button>
                        <button class="px-3 py-1 bg-red-600 text-white rounded-lg hover:bg-red-700 transition" onclick="deleteCategory(${cat.id})">üóëÔ∏è Delete</button>
                    </td>
                </tr>`;
        });
        $("#categoryTable").html(rows);
    }

    function searchCategories() {
        let search = $('#searchInput').val().toLowerCase();
        let filtered = allCategories.filter(cat => cat.name.toLowerCase().includes(search));
        displayCategories(filtered);
    }

    $("#categoryForm").submit(function (e) {
        e.preventDefault();
        let id = $("#categoryId").val();
        let formData = new FormData(this);
        let url = "/api/categories" + (id ? "/" + id : "");
        let method = id ? "PUT" : "POST";

        $.ajax({
            url: url,
            type: method,
            data: formData,
            processData: false,
            contentType: false,
            success: function () {
                bootstrap.Modal.getInstance(document.getElementById('categoryModal')).hide();
                loadCategories();
                $("#categoryForm")[0].reset();
                $("#categoryId").val("");
            }
        });
    });

    function editCategory(id) {
        $.get("/api/categories/" + id, function (cat) {
            $("#categoryId").val(cat.id);
            $("#name").val(cat.name);
            new bootstrap.Modal(document.getElementById('categoryModal')).show();
        });
    }

    function deleteCategory(id) {
        if (confirm("Are you sure?")) {
            $.ajax({
                url: "/api/categories/" + id,
                type: "DELETE",
                success: function () {
                    loadCategories();
                }
            });
        }
    }

    $(document).ready(function () {
        loadCategories();
        $('#searchInput').on('keypress', function(e) {
            if (e.which === 13) searchCategories();
        });
    });
</script>
</body>
</html>
